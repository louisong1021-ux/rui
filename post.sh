#!/usr/bin/env bash
set -euo pipefail

# ================== post.sh ==================
# åŠŸèƒ½ï¼š
# - å®‰è£… Google Chrome
# - å®‰è£…æµ…è‰²ç¾åŒ–èµ„æºï¼ˆä¸è‡ªåŠ¨åº”ç”¨ï¼‰ï¼š
#   - GTKï¼šOrchis
#   - Iconsï¼šPapirus
#   - Cursorï¼šBibata
# - å®‰è£… å¾®ä¿¡ï¼ˆFlatpak å®˜æ–¹ç‰ˆï¼‰
#
# ç‰¹åˆ«è¯´æ˜ï¼š
# - ä¸è‡ªåŠ¨ä¿®æ”¹ GNOME è®¾ç½®
# - ä¸å®‰è£…ä»»ä½• GNOME Shell æ‰©å±•
# - ä»…åœ¨å®‰è£…å®Œæˆåç»™å‡ºã€é¡¶éƒ¨ / åº•éƒ¨ç¾åŒ–æŒ‡å¯¼ã€‘
# =============================================

die(){ echo -e "\033[31mâŒ $*\033[0m" >&2; exit 1; }
need(){ command -v "$1" >/dev/null 2>&1 || die "ç¼ºå°‘å‘½ä»¤: $1"; }

need sudo
need pacman
need git

if [[ "$(id -u)" -eq 0 ]]; then
  die "è¯·ç”¨æ™®é€šç”¨æˆ·è¿è¡Œï¼ˆä¸è¦ç”¨ rootï¼‰ã€‚"
fi

echo "===== è·å– sudo æƒé™ ====="
sudo -v

echo "===== æ›´æ–° pacman æ•°æ®åº“ï¼ˆä¸å…¨é‡å‡çº§ï¼‰====="
sudo pacman -Sy --noconfirm

echo "===== å®‰è£…åŸºç¡€ä¾èµ–ï¼ˆæ„å»º AUR éœ€è¦ï¼‰====="
sudo pacman -S --needed --noconfirm base-devel git

# ---- yay ----
if ! command -v yay >/dev/null 2>&1; then
  echo "===== å®‰è£… AUR helperï¼šyay ====="
  tmpdir="$(mktemp -d)"
  trap 'rm -rf "$tmpdir"' EXIT
  git clone --depth=1 https://aur.archlinux.org/yay.git "$tmpdir/yay"
  (cd "$tmpdir/yay" && makepkg -si --noconfirm)
fi

install_pkg() {
  local pkg="$1"
  if pacman -Si "$pkg" >/dev/null 2>&1; then
    sudo pacman -S --needed --noconfirm "$pkg"
  else
    yay -S --needed --noconfirm "$pkg"
  fi
}

# ---- Chrome ----
echo "===== å®‰è£… Google Chrome ====="
yay -S --needed --noconfirm google-chrome

# ---- ç¾åŒ–èµ„æº ----
echo "===== å®‰è£…å›¾æ ‡ä¸»é¢˜ï¼ˆPapirusï¼‰====="
sudo pacman -S --needed --noconfirm papirus-icon-theme

echo "===== å®‰è£… GTK ä¸»é¢˜ï¼ˆOrchisï¼‰====="
install_pkg orchis-theme

echo "===== å®‰è£…å…‰æ ‡ä¸»é¢˜ï¼ˆBibataï¼‰====="
install_pkg bibata-cursor-theme

# ---- å¾®ä¿¡ ----
echo "===== å®‰è£… å¾®ä¿¡ï¼ˆFlatpak å®˜æ–¹ç‰ˆï¼‰====="
sudo pacman -S --needed --noconfirm flatpak
sudo flatpak remote-add --if-not-exists \
  flathub https://flathub.org/repo/flathub.flatpakrepo
sudo flatpak install -y flathub com.tencent.WeChat

# ================== å®‰è£…å®Œæˆæç¤º ==================
cat <<'EOF'

====================================================
âœ… è½¯ä»¶å®‰è£…å·²å®Œæˆ
====================================================

ä½ ç°åœ¨å¯ä»¥ã€æ‰‹åŠ¨ã€‘è¿›è¡Œ GNOME é¡¶éƒ¨ / åº•éƒ¨ç¾åŒ–ï¼ˆä¸å¼ºåˆ¶ï¼‰ï¼š

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¨ ä¸€ã€åŸºç¡€å¤–è§‚ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ‰“å¼€ï¼šGNOME Tweaks â†’ Appearance

å»ºè®®ç»„åˆï¼ˆæµ…è‰²ï¼‰ï¼š
- Applications : Orchis-Light
- Icons        : Papirus / Papirus-Light
- Cursor       : Bibata-Modern-Classic

ä¿®æ”¹åå¦‚æœªç”Ÿæ•ˆï¼šæ³¨é”€å†ç™»å½•ä¸€æ¬¡ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â¬†ï¸ äºŒã€é¡¶éƒ¨å·¥å…·æ ï¼ˆTop Barï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¸¸è§ç¾åŒ–æ–¹å¼ï¼š
- åŠé€æ˜ / æ¨¡ç³Š
- æ›´ç´§å‡‘çš„æ—¶é—´ä¸çŠ¶æ€æ˜¾ç¤º

å®ç°æ–¹å¼ï¼ˆæ¨èï¼‰ï¼š
1. æ‰“å¼€ã€ŒExtension Managerã€
2. æœç´¢å¹¶å®‰è£…ï¼šBlur My Shell
3. å¯ç”¨åï¼Œåœ¨æ‰©å±•è®¾ç½®ä¸­å¼€å¯ Top Bar æ¨¡ç³Š

âš ï¸ æç¤ºï¼šæ‰©å±• â‰¤ 2 ä¸ªï¼Œé¿å…å‡çº§é£é™©ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â¬‡ï¸ ä¸‰ã€åº•éƒ¨ Dockï¼ˆä»»åŠ¡æ ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GNOME é»˜è®¤æ²¡æœ‰åº•éƒ¨ Dockï¼Œéœ€è¦æ‰©å±•ï¼š

å¸¸ç”¨é€‰æ‹©ï¼š
- Dash to Dockï¼ˆæœ€å¸¸è§ï¼‰
- Dash to Panelï¼ˆæ›´åƒ Windowsï¼‰

å®‰è£…æ–¹å¼ï¼š
1. æ‰“å¼€ã€ŒExtension Managerã€
2. æœç´¢æ‰©å±•åç§°
3. å®‰è£… â†’ å¯ç”¨ â†’ åœ¨è®¾ç½®ä¸­è°ƒæ•´ä½ç½® / é€æ˜åº¦

å»ºè®®ï¼š
- Dock æ”¾åº•éƒ¨
- è‡ªåŠ¨éšè—
- é€æ˜åº¦é€‚ä¸­å³å¯

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§  å»ºè®®åŸåˆ™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ç³»ç»Ÿ â‰  ç¾åŒ–
- æ‰©å±•è¶Šå°‘è¶Šç¨³
- å‡ºé—®é¢˜ä¼˜å…ˆç¦ç”¨æ‰©å±•

ç¥ä½ ä½¿ç”¨æ„‰å¿«ã€‚
EOF
